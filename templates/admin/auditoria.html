{% extends base_template %}
{% load static %}

{% block title %}Auditoría del Sistema{% endblock %}

{% block content %}
<div class="auditoria-container fade-in">
    <div class="d-flex align-items-center gap-3 mb-4">
        <a href="{% url 'base:admin_dashboard' %}" class="btn btn-sm rounded-circle shadow-sm"
            style="background: var(--bg-content);">
            <span class="material-symbols-outlined align-middle">arrow_back</span>
        </a>
        <h1 class="display-6 fw-bold mb-0">Auditoría Completa</h1>
    </div>

    <div class="info-card glass-card p-4">
        <div class="table-responsive">
            <table class="table table-hover align-middle custom-table">
                <thead>
                    <tr>
                        <th class="ps-3">Fecha y Hora</th>
                        <th>Usuario</th>
                        <th>Rol</th>
                        <th>Acción</th>
                        <th>Detalle</th>
                        <th class="text-end pe-3">IP Address</th>
                    </tr>
                </thead>
                <tbody>
                    {% for log in logs %}
                    <tr>
                        <td class="ps-3">
                            <span class="fw-bold">{{ log.fecha|date:"d/m/Y" }}</span>
                            <br><small class="text-muted">{{ log.fecha|date:"H:i:s" }}</small>
                        </td>
                        <td>
                            <div class="d-flex align-items-center gap-2">
                                <div class="avatar-mini bg-primary-light text-primary rounded-circle d-flex align-items-center justify-content-center fw-bold"
                                    style="width: 32px; height: 32px; font-size: 12px;">
                                    {{ log.usuario.username.0|upper }}
                                </div>
                                <span>{{ log.usuario.username }}</span>
                            </div>
                        </td>
                        <td>
                            <span
                                class="badge rounded-pill {% if log.usuario.perfil.rol == 'ADMIN' %}bg-warning text-dark{% else %}bg-info{% endif %} small">
                                {{ log.usuario.perfil.rol }}
                            </span>
                        </td>
                        <td>
                            <span class="fw-bold text-main">{{ log.accion }}</span>
                        </td>
                        <td>
                            <span class="text-muted small">{{ log.detalle }}</span>
                        </td>
                        <td class="text-end pe-3">
                            <code class="text-secondary small">{{ log.ip_address|default:"-" }}</code>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" class="text-center py-5 text-muted">No hay registros de auditoría disponibles.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<style>
    .glass-card {
        background: var(--bg-content);
        border: 1px solid rgba(0, 0, 0, 0.05);
        border-radius: 28px;
        box-shadow: var(--card-shadow);
        overflow: hidden;
    }

    .custom-table {
        margin-bottom: 0;
    }

    .custom-table thead th {
        background: rgba(var(--primary-rgb), 0.05);
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        padding: 15px 10px;
        font-weight: 700;
        text-transform: uppercase;
        font-size: 11px;
        letter-spacing: 1px;
    }

    .custom-table tbody tr {
        transition: all 0.2s ease;
    }

    .custom-table tbody td {
        padding: 18px 10px;
        border-bottom: 1px solid rgba(0, 0, 0, 0.02);
    }

    .bg-primary-light {
        background-color: var(--primary-light);
    }
</style>
{% endblock %}